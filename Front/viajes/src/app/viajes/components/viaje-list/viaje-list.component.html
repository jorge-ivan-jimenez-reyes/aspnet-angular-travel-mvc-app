<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '50vw' }"></p-confirmDialog>

<div class="viaje-list-container">
  <p-card>
    <ng-template pTemplate="title">
      <div class="flex justify-between items-center">
        <h2>Lista de Viajes</h2>
        <p-button
          label="Nuevo Viaje"
          icon="pi pi-plus"
          (onClick)="onNewViaje()"
          styleClass="p-button-primary">
        </p-button>
      </div>
    </ng-template>

    <p-table
      #dt
      [value]="viajes"
      dataKey="id"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['origen.nombre', 'destino.nombre', 'estatus.nombre', 'transporte.nombre', 'operador', 'fechaInicio', 'fechaFin']"
      [loading]="loading"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} viajes"
      [rowHover]="true"
      [filterDelay]="0"
      [resizableColumns]="true"
      styleClass="p-datatable-sm">

      <ng-template pTemplate="caption">
        <div class="flex justify-between items-center">
          <p-button
            label="Limpiar"
            icon="pi pi-filter-slash"
            (click)="clear(dt)"
            styleClass="p-button-outlined p-button-sm">
          </p-button>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              (input)="dt.filterGlobal($any($event.target).value, 'contains')"
              placeholder="Buscar en todos los campos" />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="destino" pResizableColumn>Destino <p-sortIcon field="destino"></p-sortIcon></th>
          <th pSortableColumn="fechaInicio" pResizableColumn>Inicio <p-sortIcon field="fechaInicio"></p-sortIcon></th>
          <th pSortableColumn="fechaFin" pResizableColumn>Fin <p-sortIcon field="fechaFin"></p-sortIcon></th>
          <th pSortableColumn="presupuesto" pResizableColumn>Presupuesto <p-sortIcon field="presupuesto"></p-sortIcon></th>
          <th pSortableColumn="lugarId" pResizableColumn>Lugar ID <p-sortIcon field="lugarId"></p-sortIcon></th>
          <th pSortableColumn="estatusId" pResizableColumn>Estatus ID <p-sortIcon field="estatusId"></p-sortIcon></th>
          <th pSortableColumn="transporteId" pResizableColumn>Transporte ID <p-sortIcon field="transporteId"></p-sortIcon></th>
          <th>Acciones</th>
        </tr>
        <tr>
          <th><p-columnFilter type="text" field="destino" placeholder="Buscar por destino"></p-columnFilter></th>
          <th><p-columnFilter type="date" field="fechaInicio" placeholder="Buscar por fecha de inicio"></p-columnFilter></th>
          <th><p-columnFilter type="date" field="fechaFin" placeholder="Buscar por fecha de fin"></p-columnFilter></th>
          <th><p-columnFilter type="numeric" field="presupuesto" placeholder="Buscar por presupuesto"></p-columnFilter></th>
          <th><p-columnFilter type="numeric" field="lugarId" placeholder="Buscar por lugar ID"></p-columnFilter></th>
          <th><p-columnFilter type="numeric" field="estatusId" placeholder="Buscar por estatus ID"></p-columnFilter></th>
          <th><p-columnFilter type="numeric" field="transporteId" placeholder="Buscar por transporte ID"></p-columnFilter></th>
          <th></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-viaje>
        <tr>
          <td>{{ viaje.destino }}</td>
          <td>{{ viaje.fechaInicio | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ viaje.fechaFin | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ viaje.presupuesto | currency:'USD':'symbol':'1.2-2' }}</td>
          <td>{{ viaje.lugarId }}</td>
          <td>
            <p-tag [value]="getEstatusNombre(viaje.estatusId)" [severity]="getEstatusColor(viaje.estatusId)"></p-tag>
          </td>
          <td>{{ viaje.transporteId }}</td>
          <td>
            <p-button
              icon="pi pi-pencil"
              (onClick)="onEditViaje(viaje)"
              styleClass="p-button-rounded p-button-text p-button-success p-mr-2"
              pTooltip="Editar"
              tooltipPosition="top">
            </p-button>
            <p-button
              icon="pi pi-trash"
              (onClick)="onDeleteViaje(viaje)"
              styleClass="p-button-rounded p-button-text p-button-danger"
              pTooltip="Eliminar"
              tooltipPosition="top">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">No hay viajes registrados.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
